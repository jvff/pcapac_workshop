<h1>Executing the Kernel</h1>

<pre class="prettyprint lang-c linenums:101" data-step="0">    // ...

    stbi_image_free(sourceImageData);

    // ...
</pre>

<pre class="prettyprint lang-c linenums:101" data-step="1">    // ...

    cl_kernel kernel = clCreateKernel(/**/);            // Create kernel

    stbi_image_free(sourceImageData);

    // ...
</pre>

<pre class="prettyprint lang-c linenums:101" data-step="2">    // ...

    cl_kernel kernel = clCreateKernel(program, /**/);
                                                // Source program

    stbi_image_free(sourceImageData);

    // ...
</pre>

<pre class="prettyprint lang-c linenums:101" data-step="3">    // ...

    cl_kernel kernel = clCreateKernel(program, "grayscaleFilter," /**/);
                                                // Kernel name

    stbi_image_free(sourceImageData);

    // ...
</pre>

<pre class="prettyprint lang-c linenums:101" data-step="4">    // ...

    cl_kernel kernel = clCreateKernel(program, "grayscaleFilter," NULL);
                                                // Address to store error code

    stbi_image_free(sourceImageData);

    // ...
</pre>

<pre class="prettyprint lang-c linenums:101" data-step="5">    // ...

    cl_kernel kernel = clCreateKernel(program, "grayscaleFilter," NULL);

    stbi_image_free(sourceImageData);

    clReleaseKernel(kernel);                    // Release kernel in the end

    // ...
</pre>

<pre class="prettyprint lang-c linenums:101" data-step="6">    // ...

    cl_kernel kernel = clCreateKernel(program, "grayscaleFilter," NULL);

    clSetKernelArg(/**/);                       // Set kernel argument

    stbi_image_free(sourceImageData);

    clReleaseKernel(kernel);

    // ...
</pre>

<pre class="prettyprint lang-c linenums:101" data-step="7">    // ...

    cl_kernel kernel = clCreateKernel(program, "grayscaleFilter," NULL);

    clSetKernelArg(kernel, /**/);               // Which kernel

    stbi_image_free(sourceImageData);

    clReleaseKernel(kernel);

    // ...
</pre>

<pre class="prettyprint lang-c linenums:101" data-step="8">    // ...

    cl_kernel kernel = clCreateKernel(program, "grayscaleFilter," NULL);

    clSetKernelArg(kernel, 0, /**/);            // Parameter index

    stbi_image_free(sourceImageData);

    clReleaseKernel(kernel);

    // ...
</pre>

<pre class="prettyprint lang-c linenums:101" data-step="9">    // ...

    cl_kernel kernel = clCreateKernel(program, "grayscaleFilter," NULL);

    clSetKernelArg(kernel, 0, sizeof(sourceImageBuffer), /**/);
                                                // Parameter size

    stbi_image_free(sourceImageData);

    clReleaseKernel(kernel);

    // ...
</pre>

<pre class="prettyprint lang-c linenums:101" data-step="10">    // ...

    cl_kernel kernel = clCreateKernel(program, "grayscaleFilter," NULL);

    clSetKernelArg(kernel, 0, sizeof(sourceImageBuffer), &amp;sourceImageBuffer);
                                                // Parameter address

    stbi_image_free(sourceImageData);

    clReleaseKernel(kernel);

    // ...
</pre>

<pre class="prettyprint lang-c linenums:101" data-step="11">    // ...

    cl_kernel kernel = clCreateKernel(program, "grayscaleFilter," NULL);

    clSetKernelArg(kernel, 0, sizeof(sourceImageBuffer), &amp;sourceImageBuffer);
    clSetKernelArg(/**/);                       // Set kernel argument

    stbi_image_free(sourceImageData);

    clReleaseKernel(kernel);

    // ...
</pre>

<pre class="prettyprint lang-c linenums:101" data-step="12">    // ...

    cl_kernel kernel = clCreateKernel(program, "grayscaleFilter," NULL);

    clSetKernelArg(kernel, 0, sizeof(sourceImageBuffer), &amp;sourceImageBuffer);
    clSetKernelArg(kernel, /**/);               // Which kernel

    stbi_image_free(sourceImageData);

    clReleaseKernel(kernel);

    // ...
</pre>

<pre class="prettyprint lang-c linenums:101" data-step="13">    // ...

    cl_kernel kernel = clCreateKernel(program, "grayscaleFilter," NULL);

    clSetKernelArg(kernel, 0, sizeof(sourceImageBuffer), &amp;sourceImageBuffer);
    clSetKernelArg(kernel, 1, /**/);            // Parameter index

    stbi_image_free(sourceImageData);

    clReleaseKernel(kernel);

    // ...
</pre>

<pre class="prettyprint lang-c linenums:101" data-step="14">    // ...

    cl_kernel kernel = clCreateKernel(program, "grayscaleFilter," NULL);

    clSetKernelArg(kernel, 0, sizeof(sourceImageBuffer), &amp;sourceImageBuffer);
    clSetKernelArg(kernel, 1, sizeof(destImageBuffer), /**/);
                                                // Parameter size

    stbi_image_free(sourceImageData);

    clReleaseKernel(kernel);

    // ...
</pre>

<pre class="prettyprint lang-c linenums:101" data-step="15">    // ...

    cl_kernel kernel = clCreateKernel(program, "grayscaleFilter," NULL);

    clSetKernelArg(kernel, 0, sizeof(sourceImageBuffer), &amp;sourceImageBuffer);
    clSetKernelArg(kernel, 1, sizeof(destImageBuffer), &amp;destImageBuffer);
                                                // Parameter address

    stbi_image_free(sourceImageData);

    clReleaseKernel(kernel);

    // ...
</pre>

<pre class="prettyprint lang-c linenums:101" data-step="16">    // ...

    cl_kernel kernel = clCreateKernel(program, "grayscaleFilter," NULL);

    clSetKernelArg(kernel, 0, sizeof(sourceImageBuffer), &amp;sourceImageBuffer);
    clSetKernelArg(kernel, 1, sizeof(destImageBuffer), &amp;destImageBuffer);

    size_t globalWorkSize[] = /**/;             // Configure kernel instances

    stbi_image_free(sourceImageData);

    clReleaseKernel(kernel);

    // ...
</pre>

<pre class="prettyprint lang-c linenums:101" data-step="17">    // ...

    cl_kernel kernel = clCreateKernel(program, "grayscaleFilter," NULL);

    clSetKernelArg(kernel, 0, sizeof(sourceImageBuffer), &amp;sourceImageBuffer);
    clSetKernelArg(kernel, 1, sizeof(destImageBuffer), &amp;destImageBuffer);

    size_t globalWorkSize[] = { width, height }; // One instance per pixel

    stbi_image_free(sourceImageData);

    clReleaseKernel(kernel);

    // ...
</pre>

<pre class="prettyprint lang-c linenums:101" data-step="18">    // ...

    cl_kernel kernel = clCreateKernel(program, "grayscaleFilter," NULL);

    clSetKernelArg(kernel, 0, sizeof(sourceImageBuffer), &amp;sourceImageBuffer);
    clSetKernelArg(kernel, 1, sizeof(destImageBuffer), &amp;destImageBuffer);

    size_t globalWorkSize[] = { width, height };

    clEnqueueNDRangeKernel(/**/);               // Enqueue a kernel

    stbi_image_free(sourceImageData);

    clReleaseKernel(kernel);

    // ...
</pre>

<pre class="prettyprint lang-c linenums:101" data-step="19">    // ...

    cl_kernel kernel = clCreateKernel(program, "grayscaleFilter," NULL);

    clSetKernelArg(kernel, 0, sizeof(sourceImageBuffer), &amp;sourceImageBuffer);
    clSetKernelArg(kernel, 1, sizeof(destImageBuffer), &amp;destImageBuffer);

    size_t globalWorkSize[] = { width, height };

    clEnqueueNDRangeKernel(commandQueue, /**/); // Command queue to use

    stbi_image_free(sourceImageData);

    clReleaseKernel(kernel);

    // ...
</pre>

<pre class="prettyprint lang-c linenums:101" data-step="20">    // ...

    cl_kernel kernel = clCreateKernel(program, "grayscaleFilter," NULL);

    clSetKernelArg(kernel, 0, sizeof(sourceImageBuffer), &amp;sourceImageBuffer);
    clSetKernelArg(kernel, 1, sizeof(destImageBuffer), &amp;destImageBuffer);

    size_t globalWorkSize[] = { width, height };

    clEnqueueNDRangeKernel(commandQueue,
            kernel, /**/);                         // Kernel to execute

    stbi_image_free(sourceImageData);

    clReleaseKernel(kernel);

    // ...
</pre>

<pre class="prettyprint lang-c linenums:101" data-step="21">    // ...

    cl_kernel kernel = clCreateKernel(program, "grayscaleFilter," NULL);

    clSetKernelArg(kernel, 0, sizeof(sourceImageBuffer), &amp;sourceImageBuffer);
    clSetKernelArg(kernel, 1, sizeof(destImageBuffer), &amp;destImageBuffer);

    size_t globalWorkSize[] = { width, height };

    clEnqueueNDRangeKernel(commandQueue,
            kernel,
            2, /**/);                              // Work dimensions (1,2,3)

    stbi_image_free(sourceImageData);

    clReleaseKernel(kernel);

    // ...
</pre>

<pre class="prettyprint lang-c linenums:101" data-step="22">    // ...

    cl_kernel kernel = clCreateKernel(program, "grayscaleFilter," NULL);

    clSetKernelArg(kernel, 0, sizeof(sourceImageBuffer), &amp;sourceImageBuffer);
    clSetKernelArg(kernel, 1, sizeof(destImageBuffer), &amp;destImageBuffer);

    size_t globalWorkSize[] = { width, height };

    clEnqueueNDRangeKernel(commandQueue,
            kernel,
            2,
            NULL, /**/);                           // Global work ID offset

    stbi_image_free(sourceImageData);

    clReleaseKernel(kernel);

    // ...
</pre>

<pre class="prettyprint lang-c linenums:101" data-step="23">    // ...

    cl_kernel kernel = clCreateKernel(program, "grayscaleFilter," NULL);

    clSetKernelArg(kernel, 0, sizeof(sourceImageBuffer), &amp;sourceImageBuffer);
    clSetKernelArg(kernel, 1, sizeof(destImageBuffer), &amp;destImageBuffer);

    size_t globalWorkSize[] = { width, height };

    clEnqueueNDRangeKernel(commandQueue,
            kernel,
            2,
            NULL,
            globalWorkSize, /**/);                // Number of kernel instances

    stbi_image_free(sourceImageData);

    clReleaseKernel(kernel);

    // ...
</pre>

<pre class="prettyprint lang-c linenums:101" data-step="24">    // ...

    cl_kernel kernel = clCreateKernel(program, "grayscaleFilter," NULL);

    clSetKernelArg(kernel, 0, sizeof(sourceImageBuffer), &amp;sourceImageBuffer);
    clSetKernelArg(kernel, 1, sizeof(destImageBuffer), &amp;destImageBuffer);

    size_t globalWorkSize[] = { width, height };

    clEnqueueNDRangeKernel(commandQueue,
            kernel,
            2,
            NULL,
            globalWorkSize,
            NULL, /**/);                           // Instances per group

    stbi_image_free(sourceImageData);

    clReleaseKernel(kernel);

    // ...
</pre>

<pre class="prettyprint lang-c linenums:101" data-step="25">    // ...

    cl_kernel kernel = clCreateKernel(program, "grayscaleFilter," NULL);

    clSetKernelArg(kernel, 0, sizeof(sourceImageBuffer), &amp;sourceImageBuffer);
    clSetKernelArg(kernel, 1, sizeof(destImageBuffer), &amp;destImageBuffer);

    size_t globalWorkSize[] = { width, height };

    clEnqueueNDRangeKernel(commandQueue,
            kernel,
            2,
            NULL,
            globalWorkSize,
            NULL,
            0, /**/);                              // Number of events

    stbi_image_free(sourceImageData);

    clReleaseKernel(kernel);

    // ...
</pre>

<pre class="prettyprint lang-c linenums:101" data-step="26">    // ...

    cl_kernel kernel = clCreateKernel(program, "grayscaleFilter," NULL);

    clSetKernelArg(kernel, 0, sizeof(sourceImageBuffer), &amp;sourceImageBuffer);
    clSetKernelArg(kernel, 1, sizeof(destImageBuffer), &amp;destImageBuffer);

    size_t globalWorkSize[] = { width, height };

    clEnqueueNDRangeKernel(commandQueue,
            kernel,
            2,
            NULL,
            globalWorkSize,
            NULL,
            0,
            NULL, /**/);                           // List of events

    stbi_image_free(sourceImageData);

    clReleaseKernel(kernel);

    // ...
</pre>

<pre class="prettyprint lang-c linenums:101" data-step="27">    // ...

    cl_kernel kernel = clCreateKernel(program, "grayscaleFilter," NULL);

    clSetKernelArg(kernel, 0, sizeof(sourceImageBuffer), &amp;sourceImageBuffer);
    clSetKernelArg(kernel, 1, sizeof(destImageBuffer), &amp;destImageBuffer);

    size_t globalWorkSize[] = { width, height };

    clEnqueueNDRangeKernel(commandQueue,
            kernel,
            2,
            NULL,
            globalWorkSize,
            NULL,
            0,
            NULL,
            NULL);                                 // Address to store event

    stbi_image_free(sourceImageData);

    clReleaseKernel(kernel);

    // ...
</pre>

<script type="text/javascript">
    PR.prettyPrint();
</script>
